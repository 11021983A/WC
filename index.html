<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞—è–≤–∫–∞ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }

        .room-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .problem-list {
            margin: 20px 0;
        }

        .problem-item {
            margin: 10px 0;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .problem-item:hover {
            border-color: #2196F3;
            background-color: #f8f9ff;
        }

        .problem-item.selected {
            border-color: #2196F3;
            background-color: #e3f2fd;
        }

        .problem-item input {
            margin-right: 10px;
        }

        .custom-text {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: none;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        .submit-btn:hover {
            background: #1976D2;
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .message {
            display: none;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            text-align: center;
        }

        .success {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .error {
            background: #ffcdd2;
            color: #c62828;
        }

        .debug {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 12px;
            color: #856404;
        }

        .telegram-link {
            background: #e3f2fd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #2196F3;
        }

        .telegram-link a {
            color: #2196F3;
            text-decoration: none;
            font-weight: bold;
        }

        .telegram-link a:hover {
            text-decoration: underline;
        }

        .config-section {
            background: #fff3cd;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            border: 1px solid #ffeaa7;
            font-size: 14px;
        }

        .config-section h3 {
            margin-top: 0;
            color: #856404;
        }

        .config-input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
        }

        .config-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin: 5px 5px 5px 0;
        }

        .config-button:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –ó–∞—è–≤–∫–∞ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</h1>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–º–µ—â–µ–Ω–∏–∏ -->
        <div class="room-info" id="roomInfo">
            –ü–æ–º–µ—â–µ–Ω–∏–µ: –ó–∞–≥—Ä—É–∑–∫–∞...
        </div>

        <!-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏) -->
        <div id="configSection" class="config-section" style="display: none;">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram</h3>
            <p>–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram –±–æ—Ç–∞:</p>
            
            <label>–¢–æ–∫–µ–Ω –±–æ—Ç–∞:</label>
            <input type="text" id="botToken" class="config-input" placeholder="1234567890:AAAA-BBB-CCC..." />
            
            <label>Chat ID –≥—Ä—É–ø–ø—ã:</label>
            <input type="text" id="chatId" class="config-input" placeholder="-1001234567890" />
            
            <button class="config-button" onclick="saveTelegramConfig()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="config-button" onclick="testConnection()">üîß –¢–µ—Å—Ç</button>
            <button class="config-button" onclick="showInstructions()">‚ùì –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</button>
        </div>

        <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div id="debugInfo" class="debug" style="display: none;">
            <strong>–û—Ç–ª–∞–¥–∫–∞:</strong><br>
            URL: <span id="debugUrl"></span><br>
            –ü–∞—Ä–∞–º–µ—Ç—Ä room: <span id="debugRoom"></span><br>
            Telegram –Ω–∞—Å—Ç—Ä–æ–µ–Ω: <span id="debugTelegram"></span>
        </div>

        <form id="requestForm">
            <div class="problem-list">
                <div class="problem-item" onclick="selectProblem(this, 'soap')">
                    <input type="radio" name="problem" value="soap" id="soap">
                    <label for="soap">üßº –ó–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –º—ã–ª–æ</label>
                </div>

                <div class="problem-item" onclick="selectProblem(this, 'paper')">
                    <input type="radio" name="problem" value="paper" id="paper">
                    <label for="paper">üßª –ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –±—É–º–∞–∂–Ω—ã–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏</label>
                </div>

                <div class="problem-item" onclick="selectProblem(this, 'trash')">
                    <input type="radio" name="problem" value="trash" id="trash">
                    <label for="trash">üóëÔ∏è –í—ã–Ω–µ—Å—Ç–∏ –º—É—Å–æ—Ä</label>
                </div>

                <div class="problem-item" onclick="selectProblem(this, 'cleaning')">
                    <input type="radio" name="problem" value="cleaning" id="cleaning">
                    <label for="cleaning">üßΩ –ü—Ä–∏–±—Ä–∞—Ç—å—Å—è</label>
                </div>

                <div class="problem-item" onclick="selectProblem(this, 'other')">
                    <input type="radio" name="problem" value="other" id="other">
                    <label for="other">üìù –î—Ä—É–≥–∞—è –ø—Ä–æ–±–ª–µ–º–∞</label>
                </div>

                <textarea 
                    id="customText" 
                    class="custom-text" 
                    placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É..."
                    rows="3"
                ></textarea>
            </div>

            <button type="submit" class="submit-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        </form>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div id="successMessage" class="message success">
            ‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ò–Ω–∂–µ–Ω–µ—Ä—ã –ø–æ–ª—É—á–∏–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.
        </div>

        <div id="errorMessage" class="message error">
            ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.
        </div>

        <!-- –°—Å—ã–ª–∫–∞ –¥–ª—è —Ä—É—á–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
        <div id="telegramLinkDiv" style="display: none;"></div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram
        let telegramConfig = {
            botToken: '',
            chatId: '',
            isConfigured: false
        };

        // –î–∞–Ω–Ω—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è
        let roomData = {
            id: 'unknown',
            displayName: '–ü–æ–º–µ—â–µ–Ω–∏–µ'
        };

        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadTelegramConfig();
            loadRoomFromQR();
            updateRoomDisplay();
            checkTelegramConfig();
            showDebugInfo();
        });

        /**
         * –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Telegram –∏–∑ localStorage
         */
        function loadTelegramConfig() {
            try {
                const saved = localStorage.getItem('telegramConfig');
                if (saved) {
                    telegramConfig = JSON.parse(saved);
                    telegramConfig.isConfigured = !!(telegramConfig.botToken && telegramConfig.chatId);
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –≤ —Ñ–æ—Ä–º–µ
                    document.getElementById('botToken').value = telegramConfig.botToken || '';
                    document.getElementById('chatId').value = telegramConfig.chatId || '';
                }
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:', error);
            }
        }

        /**
         * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Telegram
         */
        function saveTelegramConfig() {
            const botToken = document.getElementById('botToken').value.trim();
            const chatId = document.getElementById('chatId').value.trim();

            if (!botToken || !chatId) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            telegramConfig = {
                botToken: botToken,
                chatId: chatId,
                isConfigured: true
            };

            try {
                localStorage.setItem('telegramConfig', JSON.stringify(telegramConfig));
                alert('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
                checkTelegramConfig();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }

        /**
         * –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –ø–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
         */
        function checkTelegramConfig() {
            const configSection = document.getElementById('configSection');
            
            if (!telegramConfig.isConfigured) {
                configSection.style.display = 'block';
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä config=1 –≤ URL
                const params = new URLSearchParams(window.location.search);
                configSection.style.display = params.get('config') === '1' ? 'block' : 'none';
            }
        }

        /**
         * –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Telegram
         */
        async function testConnection() {
            const botToken = document.getElementById('botToken').value.trim();
            const chatId = document.getElementById('chatId').value.trim();

            if (!botToken || !chatId) {
                alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ Chat ID');
                return;
            }

            const testMessage = `üîß –¢–ï–°–¢ –°–û–ï–î–ò–ù–ï–ù–ò–Ø

üìç –ü–æ–º–µ—â–µ–Ω–∏–µ: –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ
‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
üïê –í—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}

–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –±–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ! ‚úÖ`;

            try {
                const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: testMessage
                    })
                });

                const result = await response.json();

                if (result.ok) {
                    alert('‚úÖ –¢–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω! –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram.');
                } else {
                    alert(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ${result.description}`);
                }
            } catch (error) {
                alert(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`);
            }
        }

        /**
         * –ü–æ–∫–∞–∑ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
         */
        function showInstructions() {
            const instructions = `
üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ù–ê–°–¢–†–û–ô–ö–ï TELEGRAM –ë–û–¢–ê:

1Ô∏è‚É£ –°–û–ó–î–ê–ù–ò–ï –ë–û–¢–ê:
   ‚Ä¢ –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram
   ‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ /newbot
   ‚Ä¢ –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ó–∞—è–≤–∫–∏ –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ")
   ‚Ä¢ –ü—Ä–∏–¥—É–º–∞–π—Ç–µ username (–Ω–∞–ø—Ä–∏–º–µ—Ä: "service_requests_bot")
   ‚Ä¢ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¢–û–ö–ï–ù (–≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫: 1234567890:AAA-BBB-CCC...)

2Ô∏è‚É£ –°–û–ó–î–ê–ù–ò–ï –ì–†–£–ü–ü–´:
   ‚Ä¢ –°–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—É –≤ Telegram
   ‚Ä¢ –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
   ‚Ä¢ –î–∞–π—Ç–µ –±–æ—Ç—É –ø—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π

3Ô∏è‚É£ –ü–û–õ–£–ß–ï–ù–ò–ï CHAT ID:
   ‚Ä¢ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É
   ‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: https://api.telegram.org/bot–í–ê–®_–¢–û–ö–ï–ù/getUpdates
   ‚Ä¢ –ù–∞–π–¥–∏—Ç–µ chat.id –≤–∞—à–µ–π –≥—Ä—É–ø–ø—ã (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å -100...)

4Ô∏è‚É£ –ù–ê–°–¢–†–û–ô–ö–ê:
   ‚Ä¢ –í—Å—Ç–∞–≤—å—Ç–µ –¢–û–ö–ï–ù –≤ –ø–æ–ª–µ "–¢–æ–∫–µ–Ω –±–æ—Ç–∞"
   ‚Ä¢ –í—Å—Ç–∞–≤—å—Ç–µ CHAT ID –≤ –ø–æ–ª–µ "Chat ID –≥—Ä—É–ø–ø—ã"
   ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
   ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

‚ùì –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
   ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É
   ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É –±–æ—Ç–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
   ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ –∏ Chat ID
`;

            alert(instructions);
        }

        /**
         * –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–º–µ—â–µ–Ω–∏—è –∏–∑ QR-–∫–æ–¥–∞
         */
        function loadRoomFromQR() {
            const params = new URLSearchParams(window.location.search);
            const roomParam = params.get('room');
            
            if (roomParam) {
                roomData.id = roomParam;
                roomData.displayName = roomParam;
            } else {
                roomData.id = 'unknown';
                roomData.displayName = '–ü–æ–º–µ—â–µ–Ω–∏–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
            }
        }

        /**
         * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–º–µ—â–µ–Ω–∏—è
         */
        function updateRoomDisplay() {
            const roomInfo = document.getElementById('roomInfo');
            roomInfo.textContent = roomData.displayName;
        }

        /**
         * –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
         */
        function showDebugInfo() {
            const params = new URLSearchParams(window.location.search);
            if (params.get('debug') === '1') {
                const debugInfo = document.getElementById('debugInfo');
                const debugUrl = document.getElementById('debugUrl');
                const debugRoom = document.getElementById('debugRoom');
                const debugTelegram = document.getElementById('debugTelegram');
                
                debugUrl.textContent = window.location.href;
                debugRoom.textContent = params.get('room') || '–Ω–µ –Ω–∞–π–¥–µ–Ω';
                debugTelegram.textContent = telegramConfig.isConfigured ? '–î–∞' : '–ù–µ—Ç';
                
                debugInfo.style.display = 'block';
            }
        }

        /**
         * –í—ã–±–æ—Ä –ø—Ä–æ–±–ª–µ–º—ã
         */
        function selectProblem(element, problemType) {
            document.querySelectorAll('.problem-item').forEach(item => {
                item.classList.remove('selected');
            });

            element.classList.add('selected');
            const radio = element.querySelector('input');
            radio.checked = true;

            const customText = document.getElementById('customText');
            if (problemType === 'other') {
                customText.style.display = 'block';
                customText.focus();
            } else {
                customText.style.display = 'none';
                customText.value = '';
            }
        }

        /**
         * –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
         */
        async function sendToTelegram(requestData) {
            if (!telegramConfig.isConfigured) {
                throw new Error('Telegram –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
            }

            const message = `üîß –ù–û–í–ê–Ø –ó–ê–Ø–í–ö–ê –ù–ê –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–ï

üìç –ü–æ–º–µ—â–µ–Ω–∏–µ: ${requestData.roomDisplayName}

‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: ${requestData.problemDescription}

üïê –í—Ä–µ–º—è: ${requestData.date} –≤ ${requestData.time}

#–∑–∞—è–≤–∫–∞ #–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ`;

            const response = await fetch(`https://api.telegram.org/bot${telegramConfig.botToken}/sendMessage`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    chat_id: telegramConfig.chatId,
                    text: message
                })
            });

            const result = await response.json();

            if (!result.ok) {
                throw new Error(result.description || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram');
            }

            return result;
        }

        /**
         * –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è —Ä—É—á–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
         */
        function createTelegramLink(requestData) {
            const message = `üîß –ù–û–í–ê–Ø –ó–ê–Ø–í–ö–ê –ù–ê –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–ï

üìç –ü–æ–º–µ—â–µ–Ω–∏–µ: ${requestData.roomDisplayName}
‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: ${requestData.problemDescription}
üïê –í—Ä–µ–º—è: ${requestData.date} –≤ ${requestData.time}

#–∑–∞—è–≤–∫–∞ #–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ`;

            const telegramLink = `https://t.me/share/url?url=&text=${encodeURIComponent(message)}`;
            
            const linkDiv = document.getElementById('telegramLinkDiv');
            linkDiv.innerHTML = `
                <div class="telegram-link">
                    <strong>üì± –†—É—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞:</strong><br>
                    <a href="${telegramLink}" target="_blank">
                        üëÜ –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
                    </a>
                </div>
            `;
            linkDiv.style.display = 'block';
        }

        /**
         * –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
         */
        document.getElementById('requestForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const selectedProblem = document.querySelector('input[name="problem"]:checked');
            if (!selectedProblem) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É');
                return;
            }

            let problemDescription = '';
            if (selectedProblem.value === 'other') {
                const customText = document.getElementById('customText').value.trim();
                if (!customText) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É');
                    return;
                }
                problemDescription = '–î—Ä—É–≥–∞—è –ø—Ä–æ–±–ª–µ–º–∞: ' + customText;
            } else {
                const problemLabels = {
                    'soap': '–ó–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –º—ã–ª–æ',
                    'paper': '–ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –±—É–º–∞–∂–Ω—ã–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏',
                    'trash': '–í—ã–Ω–µ—Å—Ç–∏ –º—É—Å–æ—Ä',
                    'cleaning': '–ü—Ä–∏–±—Ä–∞—Ç—å—Å—è'
                };
                problemDescription = problemLabels[selectedProblem.value];
            }

            const requestData = {
                roomId: roomData.id,
                roomDisplayName: roomData.displayName,
                problemType: selectedProblem.value,
                problemDescription: problemDescription,
                date: new Date().toLocaleDateString('ru-RU'),
                time: new Date().toLocaleTimeString('ru-RU'),
                timestamp: new Date().toISOString()
            };

            await sendRequest(requestData);
        });

        /**
         * –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏
         */
        async function sendRequest(data) {
            const submitBtn = document.querySelector('.submit-btn');
            const linkDiv = document.getElementById('telegramLinkDiv');
            
            submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';
            submitBtn.disabled = true;
            linkDiv.style.display = 'none';

            try {
                if (telegramConfig.isConfigured) {
                    await sendToTelegram(data);
                    showSuccess();
                } else {
                    throw new Error('Telegram –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                createTelegramLink(data);
                showError('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Å—ã–ª–∫—É –≤—ã—à–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram');
            }

            submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É';
            submitBtn.disabled = false;
        }

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö
         */
        function showSuccess() {
            const successMsg = document.getElementById('successMessage');
            const errorMsg = document.getElementById('errorMessage');
            
            successMsg.style.display = 'block';
            errorMsg.style.display = 'none';

            setTimeout(function() {
                resetForm();
                successMsg.style.display = 'none';
            }, 3000);
        }

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
         */
        function showError(errorText = '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.') {
            const successMsg = document.getElementById('successMessage');
            const errorMsg = document.getElementById('errorMessage');
            
            errorMsg.textContent = `‚ùå ${errorText}`;
            errorMsg.style.display = 'block';
            successMsg.style.display = 'none';

            setTimeout(function() {
                errorMsg.style.display = 'none';
            }, 5000);
        }

        /**
         * –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
         */
        function resetForm() {
            document.querySelectorAll('.problem-item').forEach(item => {
                item.classList.remove('selected');
            });

            document.querySelectorAll('input[name="problem"]').forEach(radio => {
                radio.checked = false;
            });

            const customText = document.getElementById('customText');
            customText.style.display = 'none';
            customText.value = '';

            const linkDiv = document.getElementById('telegramLinkDiv');
            linkDiv.style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏)
        function testQRRoom(roomName) {
            const newUrl = `${window.location.origin}${window.location.pathname}?room=${encodeURIComponent(roomName)}`;
            window.history.pushState({}, '', newUrl);
            
            loadRoomFromQR();
            updateRoomDisplay();
            showDebugInfo();
        }

        function showExampleRooms() {
            console.log('–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:');
            console.log('testQRRoom("–¢—É–∞–ª–µ—Ç_–º—É–∂_–ö–æ—Ä–ø—É—Å_–ê_4_—ç—Ç")');
            console.log('testQRRoom("–¢—É–∞–ª–µ—Ç_–∂–µ–Ω_–ö–æ—Ä–ø—É—Å_–ë_2_—ç—Ç")');
            console.log('testQRRoom("–ö—É—Ö–Ω—è_–ö–æ—Ä–ø—É—Å_–ê_1_—ç—Ç")');
        }
    </script>
</body>
</html>
