<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞—è–≤–∫–∞ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }

        .room-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .problem-list {
            margin: 20px 0;
        }

        .problem-item {
            margin: 10px 0;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .problem-item:hover {
            border-color: #2196F3;
            background-color: #f8f9ff;
        }

        .problem-item.selected {
            border-color: #2196F3;
            background-color: #e3f2fd;
        }

        .problem-item input {
            margin-right: 10px;
        }

        .custom-text {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: none;
            box-sizing: border-box;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        .submit-btn:hover {
            background: #1976D2;
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .message {
            display: none;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            text-align: center;
        }

        .success {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .error {
            background: #ffcdd2;
            color: #c62828;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .telegram-link {
            background: #e3f2fd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #2196F3;
            text-align: center;
        }

        .telegram-link a {
            color: #2196F3;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
        }

        .telegram-link a:hover {
            text-decoration: underline;
        }

        .telegram-app-link {
            background: #0088cc;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            text-decoration: none;
            display: inline-block;
            margin: 10px 5px;
            font-weight: bold;
        }

        .telegram-app-link:hover {
            background: #006699;
            color: white;
            text-decoration: none;
        }

        .alternative-methods {
            background: #f8f9fa;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid #28a745;
        }

        .method-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .method-button:hover {
            background: #218838;
        }

        .copy-text {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            max-height: 150px;
            overflow-y: auto;
        }

        .copy-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
        }

        .copy-button:hover {
            background: #0056b3;
        }

        .debug {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 12px;
            color: #856404;
        }

        .connection-status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: center;
            font-size: 12px;
        }

        .status-online {
            background: #d4edda;
            color: #155724;
        }

        .status-offline {
            background: #f8d7da;
            color: #721c24;
        }

        .retry-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            color: #856404;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –ó–∞—è–≤–∫–∞ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</h1>
        
        <div class="room-info" id="roomInfo">
            –ü–æ–º–µ—â–µ–Ω–∏–µ: –ó–∞–≥—Ä—É–∑–∫–∞...
        </div>

        <!-- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
        <div id="connectionStatus" class="connection-status" style="display: none;">
            üì° –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...
        </div>

        <div id="debugInfo" class="debug" style="display: none;">
            <strong>–û—Ç–ª–∞–¥–∫–∞:</strong><br>
            URL: <span id="debugUrl"></span><br>
            –ü–∞—Ä–∞–º–µ—Ç—Ä room: <span id="debugRoom"></span><br>
            User Agent: <span id="debugUserAgent"></span><br>
            –°–µ—Ç—å: <span id="debugNetwork">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</span>
        </div>

        <form id="requestForm">
            <div class="problem-list">
                <div class="problem-item" onclick="selectProblem(this, 'soap')">
                    <input type="radio" name="problem" value="soap" id="soap">
                    <label for="soap">üßº –ó–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –º—ã–ª–æ</label>
                </div>

                <div class="problem-item" onclick="selectProblem(this, 'paper')">
                    <input type="radio" name="problem" value="paper" id="paper">
                    <label for="paper">üßª –ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –±—É–º–∞–∂–Ω—ã–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏</label>
                </div>

                <div class="problem-item" onclick="selectProblem(this, 'trash')">
                    <input type="radio" name="problem" value="trash" id="trash">
                    <label for="trash">üóëÔ∏è –í—ã–Ω–µ—Å—Ç–∏ –º—É—Å–æ—Ä</label>
                </div>

                <div class="problem-item" onclick="selectProblem(this, 'cleaning')">
                    <input type="radio" name="problem" value="cleaning" id="cleaning">
                    <label for="cleaning">üßΩ –ü—Ä–∏–±—Ä–∞—Ç—å—Å—è</label>
                </div>

                <div class="problem-item" onclick="selectProblem(this, 'other')">
                    <input type="radio" name="problem" value="other" id="other">
                    <label for="other">üìù –î—Ä—É–≥–∞—è –ø—Ä–æ–±–ª–µ–º–∞</label>
                </div>

                <textarea 
                    id="customText" 
                    class="custom-text" 
                    placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É..."
                    rows="3"
                ></textarea>
            </div>

            <button type="submit" class="submit-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        </form>

        <div id="successMessage" class="message success">
            ‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ò–Ω–∂–µ–Ω–µ—Ä—ã –ø–æ–ª—É—á–∏–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.
        </div>

        <div id="warningMessage" class="message warning" style="display: none;">
            ‚ö†Ô∏è –ó–∞—è–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞, –Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–¥–µ—Ä–∂–∞–Ω–æ
        </div>

        <div id="errorMessage" class="message error">
            ‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–æ—Å–æ–±—ã –Ω–∏–∂–µ:
        </div>

        <div id="retryInfo" class="retry-info" style="display: none;">
            üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ <span id="retryCounter">10</span> —Å–µ–∫...
            <button onclick="cancelRetry()" style="margin-left: 10px; background: none; border: 1px solid; border-radius: 3px; padding: 2px 8px;">–û—Ç–º–µ–Ω–∏—Ç—å</button>
        </div>

        <!-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
        <div id="alternativeMethods" class="alternative-methods" style="display: none;">
            <h3>üì± –í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –æ—Ç–ø—Ä–∞–≤–∫–∏:</h3>
            
            <!-- –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –≤ Telegram -->
            <div id="telegramLinks" style="text-align: center; margin: 15px 0;"></div>
            
            <!-- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ -->
            <div style="margin: 15px 0;">
                <button class="method-button" onclick="showCopyText()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –∑–∞—è–≤–∫–∏</button>
                <div id="copyTextDiv" style="display: none;">
                    <div class="copy-text" id="copyText"></div>
                    <button class="copy-button" onclick="copyToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>

            <!-- Email (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω) -->
            <div style="margin: 15px 0;">
                <button class="method-button" onclick="sendEmail()">üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ email</button>
            </div>

            <!-- SMS (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è) -->
            <div style="margin: 15px 0;">
                <button class="method-button" onclick="sendSMS()">üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å SMS</button>
            </div>
        </div>
    </div>

    <script>
        // ============ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–ù–ê–°–¢–†–ê–ò–í–ê–ï–¢–°–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–û–ú) ============
        
        const CONFIG = {
            // Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∑–∞–ø–æ–ª–Ω—è–µ—Ç IT-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
            telegram: {
                botToken: '8103662058:AAEwLBodQgk6oHS2oKbPHRIhxgFqWADaDo4',  // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
                chatId: '-4928953118',        // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π Chat ID –≥—Ä—É–ø–ø—ã
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
                retryAttempts: 3,
                retryDelay: 10000, // 10 —Å–µ–∫—É–Ω–¥
                timeout: 15000, // 15 —Å–µ–∫—É–Ω–¥ timeout
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —á–∞—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞—è–≤–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                chats: {
                    urgent: '-1002466052064',    // –°—Ä–æ—á–Ω—ã–µ –∑–∞—è–≤–∫–∏
                    cleaning: '-1002466052064',  // –£–±–æ—Ä–∫–∞
                    maintenance: '-1002466052064', // –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
                    default: '-1002466052064'    // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ
                }
            },
            
            // Google Sheets –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            googleSheets: {
                enabled: true,  // –í–∫–ª—é—á–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Google –¢–∞–±–ª–∏—Ü—ã
                deploymentId: 'AKfycbwbCJEGr5CNf91cvXr8ZnYeKFTGOBEybiowr-q7Q8b2sW5jS9j0rKA81HCfHCN93Xnl',
                sheetUrl: 'https://script.google.com/macros/s/AKfycbwbCJEGr5CNf91cvXr8ZnYeKFTGOBEybiowr-q7Q8b2sW5jS9j0rKA81HCfHCN93Xnl/exec',
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Google Sheets
                telegramFallback: {
                    enabled: true,  // –í–∫–ª—é—á–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –¥—É–±–ª–µ–π –∏–∑ Google Sheets
                    botToken: '8103662058:AAEwLBodQgk6oHS2oKbPHRIhxgFqWADaDo4',  // –¢–æ—Ç –∂–µ —Ç–æ–∫–µ–Ω
                    chatId: '-4928953118',  // –¢–æ—Ç –∂–µ —á–∞—Ç
                    delaySeconds: 30  // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –¥—É–±–ª—è (—Å–µ–∫—É–Ω–¥—ã)
                },
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫)
                columns: {
                    timestamp: 'A',      // –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
                    room: 'B',          // –ü–æ–º–µ—â–µ–Ω–∏–µ
                    problemType: 'C',    // –¢–∏–ø –ø—Ä–æ–±–ª–µ–º—ã
                    problemDesc: 'D',    // –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
                    status: 'E',        // –°—Ç–∞—Ç—É—Å (–ù–æ–≤–∞—è/–í —Ä–∞–±–æ—Ç–µ/–í—ã–ø–æ–ª–Ω–µ–Ω–∞)
                    telegramSent: 'F',  // –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram (–î–∞/–ù–µ—Ç)
                    userAgent: 'G',     // –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    telegramFallbackSent: 'H'  // –î—É–±–ª—å –∏–∑ Google Sheets –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
                }
            },
            
            // Email –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            email: {
                enabled: false,
                address: 'service@company.com'
            },
            
            // SMS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) 
            sms: {
                enabled: false,
                number: '+7xxxxxxxxxx'
            },
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            app: {
                companyName: '–ù–∞—à–∞ –ö–æ–º–ø–∞–Ω–∏—è',
                debug: false, // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ true –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                showConnectionStatus: true
            }
        };

        // ============ –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ============

        let roomData = {
            id: 'unknown',
            displayName: '–ü–æ–º–µ—â–µ–Ω–∏–µ'
        };

        let currentRequestData = null;
        let retryTimeout = null;
        let retryAttempt = 0;
        let isOnline = navigator.onLine;
        let telegramDelivered = false; // ‚úÖ –ù–û–í–ê–Ø –ü–ï–†–ï–ú–ï–ù–ù–ê–Ø –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏

        // ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ============

        document.addEventListener('DOMContentLoaded', function() {
            loadRoomFromQR();
            updateRoomDisplay();
            showDebugInfo();
            checkConnectionStatus();
            setupNetworkListeners();
        });

        function loadRoomFromQR() {
            const params = new URLSearchParams(window.location.search);
            const roomParam = params.get('room');
            
            if (roomParam) {
                roomData.id = roomParam;
                roomData.displayName = roomParam.replace(/_/g, ' '); // –ó–∞–º–µ–Ω—è–µ–º _ –Ω–∞ –ø—Ä–æ–±–µ–ª—ã –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
            } else {
                roomData.id = 'unknown';
                roomData.displayName = '–ü–æ–º–µ—â–µ–Ω–∏–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
            }
        }

        function updateRoomDisplay() {
            const roomInfo = document.getElementById('roomInfo');
            roomInfo.textContent = roomData.displayName;
        }

        function showDebugInfo() {
            const params = new URLSearchParams(window.location.search);
            if (params.get('debug') === '1' || CONFIG.app.debug) {
                const debugInfo = document.getElementById('debugInfo');
                const debugUrl = document.getElementById('debugUrl');
                const debugRoom = document.getElementById('debugRoom');
                const debugUserAgent = document.getElementById('debugUserAgent');
                const debugNetwork = document.getElementById('debugNetwork');
                
                debugUrl.textContent = window.location.href;
                debugRoom.textContent = params.get('room') || '–Ω–µ –Ω–∞–π–¥–µ–Ω';
                debugUserAgent.textContent = navigator.userAgent.substring(0, 100) + '...';
                debugNetwork.textContent = isOnline ? '–û–Ω–ª–∞–π–Ω' : '–û—Ñ–ª–∞–π–Ω';
                
                debugInfo.style.display = 'block';
            }
        }

        // ============ –°–ï–¢–ï–í–´–ï –§–£–ù–ö–¶–ò–ò ============

        function setupNetworkListeners() {
            window.addEventListener('online', function() {
                isOnline = true;
                updateConnectionStatus();
                console.log('üåê –°–µ—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –∑–∞—è–≤–∫–∞ –ò Telegram –Ω–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω, –ø—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
                if (currentRequestData && !telegramDelivered) {
                    console.log('üîÑ –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∑–∞—è–≤–∫—É');
                    retryTelegramSend(currentRequestData);
                }
            });

            window.addEventListener('offline', function() {
                isOnline = false;
                updateConnectionStatus();
                console.log('üìµ –°–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
                cancelRetry();
            });
        }

        function updateConnectionStatus() {
            if (!CONFIG.app.showConnectionStatus) return;
            
            const statusEl = document.getElementById('connectionStatus');
            
            if (isOnline) {
                statusEl.className = 'connection-status status-online';
                statusEl.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ';
                statusEl.style.display = 'block';
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 3000);
            } else {
                statusEl.className = 'connection-status status-offline';
                statusEl.textContent = '‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É';
                statusEl.style.display = 'block';
            }
            
            showDebugInfo(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        }

        async function checkConnectionStatus() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram API
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch(`https://api.telegram.org/bot${CONFIG.telegram.botToken}/getMe`, {
                    method: 'GET',
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    console.log('‚úÖ Telegram API –¥–æ—Å—Ç—É–ø–µ–Ω');
                    return true;
                }
            } catch (error) {
                console.log('‚ùå Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error.message);
            }
            
            return false;
        }

        // ============ –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –§–û–†–ú–´ ============

        function selectProblem(element, problemType) {
            document.querySelectorAll('.problem-item').forEach(item => {
                item.classList.remove('selected');
            });

            element.classList.add('selected');
            const radio = element.querySelector('input');
            radio.checked = true;

            const customText = document.getElementById('customText');
            if (problemType === 'other') {
                customText.style.display = 'block';
                customText.focus();
            } else {
                customText.style.display = 'none';
                customText.value = '';
            }
        }

        document.getElementById('requestForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const selectedProblem = document.querySelector('input[name="problem"]:checked');
            if (!selectedProblem) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É');
                return;
            }

            let problemDescription = '';
            if (selectedProblem.value === 'other') {
                const customText = document.getElementById('customText').value.trim();
                if (!customText) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É');
                    return;
                }
                problemDescription = '–î—Ä—É–≥–∞—è –ø—Ä–æ–±–ª–µ–º–∞: ' + customText;
            } else {
                const problemLabels = {
                    'soap': '–ó–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –º—ã–ª–æ',
                    'paper': '–ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –±—É–º–∞–∂–Ω—ã–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏',
                    'trash': '–í—ã–Ω–µ—Å—Ç–∏ –º—É—Å–æ—Ä',
                    'cleaning': '–ü—Ä–∏–±—Ä–∞—Ç—å—Å—è'
                };
                problemDescription = problemLabels[selectedProblem.value];
            }

            currentRequestData = {
                roomId: roomData.id,
                roomDisplayName: roomData.displayName,
                problemType: selectedProblem.value,
                problemDescription: problemDescription,
                date: new Date().toLocaleDateString('ru-RU'),
                time: new Date().toLocaleTimeString('ru-RU'),
                timestamp: new Date().toISOString()
            };

            // ‚úÖ –°–ë–†–û–° —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏
            telegramDelivered = false;
            retryAttempt = 0;

            await sendRequest(currentRequestData);
        });

        // ============ GOOGLE SHEETS –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø ============

        async function saveToGoogleSheets(data, telegramSent = false, needsTelegramFallback = false) {
            if (!CONFIG.googleSheets.enabled || !CONFIG.googleSheets.deploymentId) {
                throw new Error('Google Sheets –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
            }

            // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const sheetData = {
                timestamp: new Date().toLocaleString('ru-RU'),
                room: data.roomDisplayName,
                problemType: data.problemType,
                problemDescription: data.problemDescription,
                status: '–ù–æ–≤–∞—è',
                telegramSent: telegramSent ? '–î–∞' : '–ù–µ—Ç',
                userAgent: navigator.userAgent.substring(0, 100),
                telegramFallbackSent: '–ù–µ—Ç',
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
                roomId: data.roomId,
                date: data.date,
                time: data.time,
                timestampISO: data.timestamp,
                sourceUrl: window.location.href.substring(0, 200),
                networkStatus: isOnline ? 'Online' : 'Offline',
                retryAttempt: retryAttempt,
                
                // ‚úÖ –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê: fallback —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ Telegram –ù–ï –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
                needsTelegramFallback: needsTelegramFallback && !telegramSent,
                telegramFallbackConfig: (needsTelegramFallback && !telegramSent) ? {
                    botToken: CONFIG.googleSheets.telegramFallback.botToken,
                    chatId: CONFIG.googleSheets.telegramFallback.chatId,
                    delaySeconds: CONFIG.googleSheets.telegramFallback.delaySeconds
                } : null
            };

            const webAppUrl = `https://script.google.com/macros/s/${CONFIG.googleSheets.deploymentId}/exec`;
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                
                const response = await fetch(webAppUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addRequest',
                        data: sheetData
                    }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Google Sheets' + 
                    ((needsTelegramFallback && !telegramSent) ? ' (–∑–∞–ø—Ä–æ—à–µ–Ω –¥—É–±–ª—å –≤ Telegram)' : 
                     (telegramSent ? ' (Telegram –¥–æ—Å—Ç–∞–≤–ª–µ–Ω, –¥—É–±–ª—å –ù–ï –Ω—É–∂–µ–Ω)' : '')));
                return { success: true };
                
            } catch (error) {
                if (error.name === 'AbortError') {
                    throw new Error('–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è');
                }
                throw error;
            }
        }

        // ============ TELEGRAM –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø ============

        async function sendToTelegram(data, attempt = 1) {
            if (!CONFIG.telegram.botToken || !CONFIG.telegram.chatId) {
                throw new Error('Telegram –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
            }

            if (!isOnline) {
                throw new Error('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
            }

            const message = `üîß –ù–û–í–ê–Ø –ó–ê–Ø–í–ö–ê –ù–ê –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–ï

üìç –ü–æ–º–µ—â–µ–Ω–∏–µ: ${data.roomDisplayName}

‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: ${data.problemDescription}

üïê –í—Ä–µ–º—è: ${data.date} –≤ ${data.time}

${attempt > 1 ? `üîÑ –ü–æ–ø—ã—Ç–∫–∞: ${attempt}` : ''}

#–∑–∞—è–≤–∫–∞ #–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ`;

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), CONFIG.telegram.timeout);

                const response = await fetch(`https://api.telegram.org/bot${CONFIG.telegram.botToken}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: CONFIG.telegram.chatId,
                        text: message,
                        parse_mode: 'HTML'
                    }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    const errorText = await response.text();
                    let errorMsg = `HTTP ${response.status}`;
                    
                    try {
                        const errorJson = JSON.parse(errorText);
                        errorMsg = errorJson.description || errorMsg;
                    } catch (e) {
                        // –ï—Å–ª–∏ –Ω–µ JSON, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ç—É—Å
                    }
                    
                    throw new Error(errorMsg);
                }

                const result = await response.json();
                
                if (!result.ok) {
                    throw new Error(result.description || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ Telegram API');
                }

                return result;

            } catch (error) {
                if (error.name === 'AbortError') {
                    throw new Error('–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è');
                }
                throw error;
            }
        }

        // ============ –ü–û–í–¢–û–†–ù–´–ï –ü–û–ü–´–¢–ö–ò ============

        function retryTelegramSend(data) {
            // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ Telegram
            if (telegramDelivered) {
                console.log('‚úÖ Telegram —É–∂–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞');
                return;
            }

            if (retryAttempt >= CONFIG.telegram.retryAttempts) {
                console.log(`‚ùå –ò—Å—á–µ—Ä–ø–∞–Ω—ã –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ (${retryAttempt})`);
                return;
            }

            retryAttempt++;
            console.log(`üîÑ –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ ${retryAttempt}/${CONFIG.telegram.retryAttempts}`);

            retryTimeout = setTimeout(async () => {
                try {
                    await sendToTelegram(data, retryAttempt);
                    
                    // ‚úÖ –í–ê–ñ–ù–û: –ø–æ–º–µ—á–∞–µ–º Telegram –∫–∞–∫ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π
                    telegramDelivered = true;
                    console.log('‚úÖ Telegram: –∑–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–∏ —Ñ–æ–Ω–æ–≤–æ–π –ø–æ–ø—ã—Ç–∫–µ');
                    
                    hideRetryCounter();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ Google Sheets (–ë–ï–ó –∑–∞–ø—Ä–æ—Å–∞ –¥—É–±–ª—è)
                    try {
                        await saveToGoogleSheets(data, true, false);
                        console.log('‚úÖ Google Sheets: —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω –ø–æ—Å–ª–µ —Ñ–æ–Ω–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏');
                    } catch (error) {
                        console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ Google Sheets:', error.message);
                    }
                    
                } catch (error) {
                    console.log(`‚ùå –§–æ–Ω–æ–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ ${retryAttempt} –Ω–µ —É–¥–∞–ª–∞—Å—å:`, error.message);
                    
                    if (retryAttempt < CONFIG.telegram.retryAttempts && isOnline && !telegramDelivered) {
                        retryTelegramSend(data); // –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
                    } else {
                        hideRetryCounter();
                        console.log('‚ùå –í—Å–µ —Ñ–æ–Ω–æ–≤—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø–æ–ª—É—á–∏–ª –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ');
                        
                        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–¥–µ—Å—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ –ø—Ä–æ–±–ª–µ–º–µ
                        logSystemError('Telegram delivery failed after all retries', {
                            roomId: data.roomId,
                            problemType: data.problemType,
                            attempts: retryAttempt,
                            lastError: error.message
                        });
                    }
                }
            }, CONFIG.telegram.retryDelay);
        }

        function showRetryCounter() {
            // –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—á–µ—Ç—á–∏–∫ - –≤—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–µ
            console.log(`üîÑ –§–æ–Ω–æ–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram —á–µ—Ä–µ–∑ ${CONFIG.telegram.retryDelay / 1000} —Å–µ–∫...`);
        }

        function hideRetryCounter() {
            const retryInfo = document.getElementById('retryInfo');
            retryInfo.style.display = 'none';
        }

        function cancelRetry() {
            if (retryTimeout) {
                clearTimeout(retryTimeout);
                retryTimeout = null;
                hideRetryCounter();
                console.log('üö´ –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–º–µ–Ω–µ–Ω—ã');
            }
        }

        // ============ –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –û–¢–ü–†–ê–í–ö–ò ============

        async function sendRequest(data) {
            const submitBtn = document.querySelector('.submit-btn');
            submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';
            submitBtn.disabled = true;

            let telegramSuccess = false;
            let sheetsSuccess = false;

            // ‚úÖ –ò–ó–ú–ï–ù–ï–ù–ê –õ–û–ì–ò–ö–ê: —Å–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
            try {
                await sendToTelegram(data, 1);
                telegramSuccess = true;
                telegramDelivered = true; // ‚úÖ –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π
                console.log('‚úÖ Telegram: –∑–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞');
                
            } catch (error) {
                console.log('‚ùå Telegram: –ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å -', error.message);
                telegramSuccess = false;
                telegramDelivered = false; // ‚úÖ –ù–ï –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, –Ω–∞—á–∏–Ω–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤ —Ñ–æ–Ω–µ
                if (isOnline && CONFIG.telegram.retryAttempts > 1) {
                    setTimeout(() => retryTelegramSend(data), CONFIG.telegram.retryDelay);
                    console.log('üîÑ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã —Ñ–æ–Ω–æ–≤—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram');
                }
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Google Sheets —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π fallback
            try {
                // ‚úÖ –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: fallback –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ Telegram –ù–ï –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
                const needsFallback = CONFIG.googleSheets.telegramFallback.enabled && !telegramSuccess;
                
                await saveToGoogleSheets(data, telegramSuccess, needsFallback);
                sheetsSuccess = true;
                console.log('‚úÖ Google Sheets: –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã' + 
                    (needsFallback ? ' (–∑–∞–ø—Ä–æ—à–µ–Ω Telegram –¥—É–±–ª—å, —Ç.–∫. –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)' : 
                     (telegramSuccess ? ' (Telegram –¥–æ—Å—Ç–∞–≤–ª–µ–Ω, –¥—É–±–ª—å –ù–ï –Ω—É–∂–µ–Ω)' : '')));
                     
            } catch (error) {
                console.log('‚ùå Google Sheets: –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å -', error.message);
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            if (telegramSuccess || sheetsSuccess) {
                // –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã —á—Ç–æ-—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
                if (telegramSuccess) {
                    showSuccess('‚úÖ –°–ø–∞—Å–∏–±–æ! –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω–∂–µ–Ω–µ—Ä–∞–º!');
                    console.log('‚úÖ –ü–æ–ª–Ω—ã–π —É—Å–ø–µ—Ö: —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ Telegram');
                } else {
                    showSuccess('‚úÖ –°–ø–∞—Å–∏–±–æ! –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞ –∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –∏–Ω–∂–µ–Ω–µ—Ä–∞–º!');
                    console.log('‚úÖ –ß–∞—Å—Ç–∏—á–Ω—ã–π —É—Å–ø–µ—Ö: –∑–∞—è–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞, –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥—É–±–ª—å –∏–∑ Google Sheets');
                }
                
            } else {
                // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–æ–æ–±—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
                console.log('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –Ω–∏ Telegram, –Ω–∏ Google Sheets –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏');
                showAlternativeMethods(data);
            }

            submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É';
            submitBtn.disabled = false;
        }

        // ============ –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –°–¢–ê–¢–£–°–ê –ü–û–°–õ–ï –£–°–ü–ï–®–ù–û–ô –§–û–ù–û–í–û–ô –û–¢–ü–†–ê–í–ö–ò ============
        
        async function updateGoogleSheetsAfterTelegramSuccess(data) {
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —É–∫–∞–∑—ã–≤–∞—è —á—Ç–æ Telegram –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
                await saveToGoogleSheets(data, true, false); // telegram = true, fallback = false
                console.log('‚úÖ Google Sheets: —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω - Telegram –¥–æ—Å—Ç–∞–≤–ª–µ–Ω');
            } catch (error) {
                console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ Google Sheets:', error.message);
            }
        }

        // ============ –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ï –°–ü–û–°–û–ë–´ –û–¢–ü–†–ê–í–ö–ò ============

        function showAlternativeMethods(data) {
            const errorMsg = document.getElementById('errorMessage');
            const alternativeMethods = document.getElementById('alternativeMethods');
            
            errorMsg.style.display = 'block';
            alternativeMethods.style.display = 'block';
            
            createTelegramLinks(data);
            prepareCopyText(data);
        }

        function createTelegramLinks(data) {
            const message = formatMessage(data);
            const telegramLinks = document.getElementById('telegramLinks');
            
            // –°—Å—ã–ª–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –ª—é–±–æ–π —á–∞—Ç Telegram
            const shareLink = `https://t.me/share/url?url=&text=${encodeURIComponent(message)}`;
            
            // –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —á–∞—Ç (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω username –≥—Ä—É–ø–ø—ã)
            const directLink = CONFIG.telegram.chatUsername ? 
                `https://t.me/${CONFIG.telegram.chatUsername}?text=${encodeURIComponent(message)}` : null;
            
            let linksHTML = `
                <a href="${shareLink}" target="_blank" class="telegram-app-link">
                    üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ Telegram
                </a>
            `;
            
            if (directLink) {
                linksHTML += `
                    <a href="${directLink}" target="_blank" class="telegram-app-link">
                        üí¨ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏
                    </a>
                `;
            }
            
            telegramLinks.innerHTML = linksHTML;
        }

        function prepareCopyText(data) {
            const copyText = document.getElementById('copyText');
            const message = formatMessage(data);
            copyText.textContent = message;
        }

        function formatMessage(data) {
            return `üîß –ù–û–í–ê–Ø –ó–ê–Ø–í–ö–ê –ù–ê –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–ï

üìç –ü–æ–º–µ—â–µ–Ω–∏–µ: ${data.roomDisplayName}

‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: ${data.problemDescription}

üïê –í—Ä–µ–º—è: ${data.date} –≤ ${data.time}

#–∑–∞—è–≤–∫–∞ #–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ`;
        }

        function showCopyText() {
            const copyTextDiv = document.getElementById('copyTextDiv');
            const isVisible = copyTextDiv.style.display !== 'none';
            copyTextDiv.style.display = isVisible ? 'none' : 'block';
        }

        async function copyToClipboard() {
            const copyText = document.getElementById('copyText');
            const textToCopy = copyText.textContent;
            
            try {
                // –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(textToCopy);
                    alert('‚úÖ –¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –¢–µ–ø–µ—Ä—å –≤—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ Telegram.');
                    return;
                }
            } catch (err) {
                console.log('–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å:', err);
            }
            
            // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ –∏–ª–∏ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            try {
                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.focus();
                textarea.select();
                
                const successful = document.execCommand('copy');
                document.body.removeChild(textarea);
                
                if (successful) {
                    alert('‚úÖ –¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –¢–µ–ø–µ—Ä—å –≤—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ Telegram.');
                } else {
                    throw new Error('–ö–æ–º–∞–Ω–¥–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞');
                }
            } catch (err) {
                console.log('Fallback –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å:', err);
                
                // –ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–ø–æ—Å–æ–± - –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                const range = document.createRange();
                range.selectNode(copyText);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                
                alert('‚ùå –ê–≤—Ç–æ–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –í—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é (Ctrl+C –∏–ª–∏ –¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ).');
            }
        }

        function sendEmail() {
            if (!CONFIG.email.enabled) {
                alert('Email –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.');
                return;
            }
            
            const subject = `–ó–∞—è–≤–∫–∞ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ: ${currentRequestData.roomDisplayName}`;
            const body = formatMessage(currentRequestData);
            const emailLink = `mailto:${CONFIG.email.address}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            window.location.href = emailLink;
        }

        function sendSMS() {
            if (!CONFIG.sms.enabled) {
                alert('SMS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.');
                return;
            }
            
            const message = formatMessage(currentRequestData);
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É SMS
            const shortMessage = message.substring(0, 160);
            const smsLink = `sms:${CONFIG.sms.number}?body=${encodeURIComponent(shortMessage)}`;
            
            window.location.href = smsLink;
        }

        // ============ –ò–ù–¢–ï–†–§–ï–ô–° ============

        function showSuccess(message = '‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ò–Ω–∂–µ–Ω–µ—Ä—ã –ø–æ–ª—É—á–∏–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.') {
            hideAllMessages();
            const successMsg = document.getElementById('successMessage');
            successMsg.textContent = message;
            successMsg.style.display = 'block';

            setTimeout(function() {
                resetForm();
                successMsg.style.display = 'none';
            }, 5000);
        }

        function showWarning(message) {
            hideAllMessages();
            const warningMsg = document.getElementById('warningMessage');
            warningMsg.textContent = message;
            warningMsg.style.display = 'block';
        }

        function hideAllMessages() {
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('warningMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('alternativeMethods').style.display = 'none';
            cancelRetry();
        }

        function resetForm() {
            document.querySelectorAll('.problem-item').forEach(item => {
                item.classList.remove('selected');
            });

            document.querySelectorAll('input[name="problem"]').forEach(radio => {
                radio.checked = false;
            });

            const customText = document.getElementById('customText');
            customText.style.display = 'none';
            customText.value = '';

            hideAllMessages();
            currentRequestData = null;
            retryAttempt = 0;
            telegramDelivered = false; // ‚úÖ –°–ë–†–û–° —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
        }

        // ============ –§–£–ù–ö–¶–ò–ò –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ò –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò ============

        function testQRRoom(roomName) {
            const newUrl = `${window.location.origin}${window.location.pathname}?room=${encodeURIComponent(roomName)}`;
            window.history.pushState({}, '', newUrl);
            
            loadRoomFromQR();
            updateRoomDisplay();
            showDebugInfo();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ—à–∏–±–æ–∫ (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É)
        function logSystemError(message, details = {}) {
            const errorLog = {
                timestamp: new Date().toISOString(),
                message: message,
                details: details,
                userAgent: navigator.userAgent,
                url: window.location.href
            };
            
            console.error('üö® –°–∏—Å—Ç–µ–º–Ω–∞—è –æ—à–∏–±–∫–∞:', errorLog);
            
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –æ—à–∏–±–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É:
            // - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π Telegram —á–∞—Ç –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
            // - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç Google Sheets –¥–ª—è –æ—à–∏–±–æ–∫
            // - –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            
            // –ü—Ä–∏–º–µ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—à–∏–±–∫–∏ –≤ Google Sheets (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            if (CONFIG.googleSheets.enabled) {
                try {
                    saveErrorToGoogleSheets(errorLog);
                } catch (error) {
                    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫—É –≤ Google Sheets:', error);
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        async function saveErrorToGoogleSheets(errorLog) {
            const errorData = {
                timestamp: new Date().toLocaleString('ru-RU'),
                type: 'SYSTEM_ERROR',
                message: errorLog.message,
                details: JSON.stringify(errorLog.details),
                userAgent: errorLog.userAgent.substring(0, 100),
                url: errorLog.url,
                roomId: errorLog.details.roomId || 'unknown'
            };

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —Ç–æ—Ç –∂–µ Google Sheets, –Ω–æ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º ERROR_
            const webAppUrl = `https://script.google.com/macros/s/${CONFIG.googleSheets.deploymentId}/exec`;
            
            try {
                await fetch(webAppUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addError',
                        data: errorData
                    })
                });
                console.log('üìä –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞');
            } catch (error) {
                console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫—É:', error);
            }
        }

        // ============ –¢–ï–°–¢–û–í–´–ï –§–£–ù–ö–¶–ò–ò ============

        async function quickTest() {
            console.log('üîß –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –∑–∞—è–≤–æ–∫');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏
            console.log('üåê –°—Ç–∞—Ç—É—Å —Å–µ—Ç–∏:', isOnline ? '–û–Ω–ª–∞–π–Ω' : '–û—Ñ–ª–∞–π–Ω');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram API
            const telegramAvailable = await checkConnectionStatus();
            console.log('üì± Telegram API:', telegramAvailable ? '–î–æ—Å—Ç—É–ø–µ–Ω' : '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è
            console.log('üìç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–µ—â–µ–Ω–∏–π:');
            testQRRoom('–¢—É–∞–ª–µ—Ç_–º—É–∂_–ö–æ—Ä–ø—É—Å_–ê_4_—ç—Ç');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
            console.log('‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:', {
                telegramConfigured: !!(CONFIG.telegram.botToken && CONFIG.telegram.chatId),
                googleSheetsEnabled: CONFIG.googleSheets.enabled,
                emailEnabled: CONFIG.email.enabled,
                smsEnabled: CONFIG.sms.enabled,
                retryAttempts: CONFIG.telegram.retryAttempts,
                retryDelay: CONFIG.telegram.retryDelay,
                timeout: CONFIG.telegram.timeout,
                telegramDeliveryStatus: telegramDelivered
            });

            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ
            console.log('üì± –ë—Ä–∞—É–∑–µ—Ä:', {
                userAgent: navigator.userAgent.substring(0, 50) + '...',
                cookieEnabled: navigator.cookieEnabled,
                language: navigator.language,
                platform: navigator.platform,
                clipboard: !!(navigator.clipboard && window.isSecureContext)
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Google Sheets —Å Telegram Fallback
        async function testGoogleSheetsWithFallback() {
            console.log('üìäüîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Google Sheets —Å Telegram Fallback...');
            
            const testData = {
                roomId: 'TEST_FALLBACK_ROOM',
                roomDisplayName: '–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ (Fallback)',
                problemType: 'test_fallback',
                problemDescription: '–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Google Sheets',
                date: new Date().toLocaleDateString('ru-RU'),
                time: new Date().toLocaleTimeString('ru-RU'),
                timestamp: new Date().toISOString()
            };

            try {
                // –ò–º–∏—Ç–∏—Ä—É–µ–º —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ Telegram –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –Ω–æ –Ω—É–∂–µ–Ω fallback
                telegramDelivered = false; // ‚úÖ –ò–º–∏—Ç–∏—Ä—É–µ–º –Ω–µ—É—Å–ø–µ—à–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É
                await saveToGoogleSheets(testData, false, true);
                console.log('‚úÖ –¢–µ—Å—Ç —Å Fallback –∑–∞–ø—É—â–µ–Ω! –î—É–±–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤ Telegram —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥.');
                console.log('üì± –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–∞—Ç Telegram –∏ Google Sheets —á–µ—Ä–µ–∑ 1-2 –º–∏–Ω—É—Ç—ã.');
            } catch (error) {
                console.log('‚ùå –¢–µ—Å—Ç —Å Fallback –Ω–µ –ø—Ä–æ—à–µ–ª:', error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ (–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥—É–±–ª—è)
        async function testTelegramSuccess() {
            console.log('‚úÖüìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ Telegram (–¥—É–±–ª—å –ù–ï –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è)...');
            
            const testData = {
                roomId: 'TEST_SUCCESS_ROOM',
                roomDisplayName: '–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ (–£—Å–ø–µ—Ö)',
                problemType: 'test_success',
                problemDescription: '–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥—É–±–ª–µ–π –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–µ',
                date: new Date().toLocaleDateString('ru-RU'),
                time: new Date().toLocaleTimeString('ru-RU'),
                timestamp: new Date().toISOString()
            };

            try {
                // –ò–º–∏—Ç–∏—Ä—É–µ–º —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ Telegram —É—Å–ø–µ—à–Ω–æ —Å—Ä–∞–±–æ—Ç–∞–ª
                telegramDelivered = true; // ‚úÖ –ò–º–∏—Ç–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É
                await saveToGoogleSheets(testData, true, false); // telegram=true, fallback=false
                console.log('‚úÖ –¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∑–∞–ø—É—â–µ–Ω! –î—É–±–ª—å –ù–ï –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤ Telegram.');
                console.log('üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Google Sheets - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–∏—Å—å —Å "Telegram –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: –î–∞"');
            } catch (error) {
                console.log('‚ùå –¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–µ –ø—Ä–æ—à–µ–ª:', error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Telegram
        async function testTelegram() {
            console.log('üì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Telegram...');
            
            const testData = {
                roomId: 'TEST_ROOM',
                roomDisplayName: '–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ',
                problemType: 'test',
                problemDescription: '–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Telegram',
                date: new Date().toLocaleDateString('ru-RU'),
                time: new Date().toLocaleTimeString('ru-RU'),
                timestamp: new Date().toISOString()
            };

            try {
                await sendToTelegram(testData);
                telegramDelivered = true;
                console.log('‚úÖ –¢–µ—Å—Ç Telegram —É—Å–ø–µ—à–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–∞—Ç.');
            } catch (error) {
                telegramDelivered = false;
                console.log('‚ùå –¢–µ—Å—Ç Telegram –Ω–µ –ø—Ä–æ—à–µ–ª:', error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É
        function openGoogleSheets() {
            if (CONFIG.googleSheets.sheetUrl) {
                window.open(CONFIG.googleSheets.sheetUrl, '_blank');
            } else {
                console.log('‚ùå URL Google Sheets –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
            }
        }

        // –í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
        function enableDebug() {
            CONFIG.app.debug = true;
            CONFIG.app.showConnectionStatus = true;
            showDebugInfo();
            updateConnectionStatus();
            console.log('üîß –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –≤–∫–ª—é—á–µ–Ω');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º
        async function healthCheck() {
            console.log('üè• –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º...');
            
            const results = {
                network: isOnline,
                telegram: false,
                googleSheets: false,
                clipboard: !!(navigator.clipboard && window.isSecureContext),
                telegramDeliveryStatus: telegramDelivered
            };

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram
            try {
                results.telegram = await checkConnectionStatus();
            } catch (error) {
                console.log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ Telegram:', error.message);
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Google Sheets (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)
            try {
                if (CONFIG.googleSheets.enabled && CONFIG.googleSheets.deploymentId) {
                    results.googleSheets = true;
                }
            } catch (error) {
                console.log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ Google Sheets:', error.message);
            }

            console.log('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:', results);
            
            // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            const recommendations = [];
            if (!results.network) recommendations.push('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
            if (!results.telegram) recommendations.push('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram (—Ç–æ–∫–µ–Ω, chat ID)');
            if (!results.googleSheets) recommendations.push('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Google Sheets');
            if (!results.clipboard) recommendations.push('–î–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–µ–Ω HTTPS –∏–ª–∏ localhost');

            if (recommendations.length > 0) {
                console.log('üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:', recommendations);
            } else {
                console.log('‚úÖ –í—Å–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!');
            }

            return results;
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
        window.quickTest = quickTest;
        window.testGoogleSheetsWithFallback = testGoogleSheetsWithFallback;
        window.testTelegramSuccess = testTelegramSuccess;
        window.testTelegram = testTelegram;
        window.healthCheck = healthCheck;
        window.enableDebug = enableDebug;
        window.openGoogleSheets = openGoogleSheets;
        window.testQRRoom = testQRRoom;

        // –õ–æ–≥ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
        console.log('üöÄ –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Å–∏—Å—Ç–µ–º–∞ –∑–∞—è–≤–æ–∫ —Å Telegram Fallback –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!');
        console.log('');
        console.log('‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:');
        console.log('   ‚Ä¢ –î—É–±–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ù–ï –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ');
        console.log('   ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è telegramDelivered –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è');
        console.log('   ‚Ä¢ –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ fallback');
        console.log('   ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ (–±–µ–∑ –¥—É–±–ª—è)');
        console.log('');
        console.log('üí° –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:');
        console.log('   quickTest() - –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º');
        console.log('   healthCheck() - –ø–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞');
        console.log('   testGoogleSheetsWithFallback() - —Ç–µ—Å—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π');
        console.log('   testTelegramSuccess() - —Ç–µ—Å—Ç –ë–ï–ó –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π');
        console.log('   testTelegram() - —Ç–µ—Å—Ç –ø—Ä—è–º–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram');
        console.log('   enableDebug() - –≤–∫–ª—é—á–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–µ–∂–∏–º');
    </script>
</body>
</html>
